{
  "id": "1765099229142",
  "name": "Project 1 (PRD -> To Proje...)",
  "description": "PRD -> To Project. User interface. Multi Project Management -> wnhere each project gets multi- threaded git worktree feature developmental threads. allows adding reference projects (github/npmjs/or uploaded codefiles/ or youtube transcripts or any other contexts).",
  "status": "active",
  "architecture": "### ⚠️ Synthesis Error\n\nThe Council failed to merge sub-agent outputs. Please retry with a clearer scope.",
  "techStack": [],
  "libraries": [],
  "researchContexts": [],
  "chatHistory": [
    {
      "id": "init",
      "role": "assistant",
      "content": "**System Online.** Project initialized with goal: \"PRD -> To Project. User interface. Multi Project Management -> wnhere each project gets multi- threaded git worktree feature developmental threads. allows adding reference projects (github/npmjs/or uploaded codefiles/ or youtube transcripts or any other contexts).\".\n\nStandby for Architect Analysis...",
      "timestamp": "2025-12-07T09:20:29.142Z",
      "type": "text"
    },
    {
      "id": "1765099292428",
      "role": "assistant",
      "content": "**Orchestrator**: Autonomous Workflow Initiated.\n**Objective**: Design the architecture for this project goal.\n**Strategy**: Researcher → Architect → Coder → Council",
      "timestamp": "2025-12-07T09:21:32.428Z"
    },
    {
      "id": "1765099394257",
      "role": "assistant",
      "content": "Architecting solution structure...",
      "timestamp": "2025-12-07T09:23:14.257Z",
      "type": "workflow_step"
    }
  ],
  "lastUpdated": "2025-12-07T09:23:14.272Z",
  "files": {},
  "upgrades": [],
  "evolutionStatus": "idle",
  "activeWorkflow": {
    "id": "wf-1765099292423",
    "intent": "Design the architecture for this project goal.",
    "steps": [
      {
        "id": "step-0",
        "name": "Researcher",
        "agentType": "EXPLORER",
        "description": "Executing Researcher protocol...",
        "status": "completed",
        "output": "This architecture leverages **Electron** for native file system access (critical for managing Git worktrees) combined with a **Local RAG (Retrieval-Augmented Generation) pipeline** to handle the diverse context inputs (YouTube, GitHub, PDFs).\n\n### **High-Level System Architecture**\n\nThe system follows a **Local-First, Modular Monolith** pattern. It runs primarily on the user's machine to manipulate the file system directly, ensuring high performance for Git operations and secure local data handling.\n\n```mermaid\ngraph TD\n    User[User] --> UI[Electron Renderer (React/Next.js)]\n    UI -- IPC Messages --> Main[Electron Main Process (Node.js)]\n    \n    subgraph \"Core Logic (Main Process)\"\n        Orchestrator[Project Orchestrator]\n        GW[Git Worktree Manager]\n        RAG[Context Engine (RAG)]\n    end\n    \n    subgraph \"Data & Storage\"\n        SQLite[(Project Metadata DB)]\n        VectorDB[(ChromaDB/LanceDB - Embeddings)]\n        FS[Local File System (Repos/Worktrees)]\n    end\n    \n    subgraph \"External/AI\"\n        LLM[LLM API / Local Ollama]\n        Scraper[Web/YouTube Ingestion]\n    end\n\n    Main --> Orchestrator\n    Orchestrator --> GW\n    Orchestrator --> RAG\n    GW --> FS\n    RAG --> VectorDB\n    RAG --> Scraper\n    Orchestrator --> LLM\n```\n\n---\n\n### **1. Core Modules Breakdown**\n\n#### **A. The Project Orchestrator (The \"Brain\")**\nThis module converts the PRD into actionable coding tasks.\n*   **Input:** PRD (Text/Markdown), Reference Contexts.\n*   **Role:**\n    1.  Uses an LLM (e.g., Claude 3.5 Sonnet or GPT-4o) to break the PRD into a **Task Graph** (e.g., \"Setup Auth\", \"Build Dashboard\", \"API Schema\").\n    2.  Assigns each task to a \"Development Thread.\"\n    3.  Monitors the status of each thread.\n\n#### **B. Git Worktree Manager (The \"Multi-Threaded\" Engine)**\nStandard Git switches branches sequentially. This module enables **parallel** development by creating a separate folder for each active feature.\n*   **Mechanism:**\n    *   Instead of `git checkout feature-branch`, it executes:\n        `git worktree add ./.threads/feature-branch feature-branch`\n    *   This creates a physical folder isolated from the main codebase.\n*   **Benefit:** Agent A can run the frontend server in `/.threads/ui-feature` while Agent B runs backend tests in `/.threads/api-fix` simultaneously without file lock conflicts.\n\n#### **C. Context Engine (RAG Pipeline)**\nHandles the \"Reference Projects\" requirement.\n*   **Ingestion Pipelines:**\n    *   **YouTube:** Uses `yt-dlp` to fetch audio -> `Whisper` for transcription -> Text Chunking.\n    *   **GitHub/NPM:** Clones repo/unpacks tarball -> Parses code (AST parsing) -> Text Chunking.\n    *   **Uploaded Files:** PDF/Docx parsers.\n*   **Storage:** Stores embeddings in **ChromaDB** or **LanceDB** (embedded vector databases that run locally without Docker).\n*   **Retrieval:** When an agent is coding, it queries this DB: *\"Show me how authentication was handled in the reference YouTube transcript.\"*\n\n---\n\n### **2. Data Flow: PRD to Project**\n\n| Stage | Action | Technical Implementation |\n| :--- | :--- | :--- |\n| **1. Ingestion** | User uploads PRD & links YouTube video. | System chunks PRD. `yt-dlp` downloads transcript. Embeddings stored in VectorDB. |\n| **2. Planning** | Orchestrator plans tasks. | LLM reads PRD + retrieves relevant context. Generates JSON list of tickets (Jira-style). |\n| **3. Spawning** | System creates \"Threads\". | `git branch create feature/login`; `git worktree add .worktrees/feature-login`. |\n| **4. Coding** | Agents work in parallel. | Agent 1 writes to `.worktrees/feature-login/src`; Agent 2 writes to `.worktrees/setup-db/src`. |\n| **5. Merge** | Feature complete. | `git merge` back to main; `git worktree remove .worktrees/feature-login`. |\n\n---\n\n### **3. Recommended Tech Stack**\n\n| Component | Technology | Why? |\n| :--- | :--- | :--- |\n| **App Shell** | **Electron** | Required for full access to run `git` commands and manage file system worktrees. |\n| **Frontend** | **React + Tailwind** | Rich UI to visualize the \"Threads\" (kanban style) and chat with agents. |\n| **Backend Logic** | **Node.js (Built-in)** | Electron's main process is Node.js, perfect for `simple-git` or `isomorphic-git` libraries. |\n| **Vector DB** | **LanceDB** | Serverless, stores data in local files, extremely fast, specifically designed for multi-modal data. |\n| **AI Orchestration**| **LangChain.js** | Manages the prompts, context retrieval, and agent chains in JavaScript/TypeScript. |\n| **Video Tools** | **yt-dlp** (binary) | The industry standard for extracting data from YouTube; executed via `child_process`. |\n\n---\n\n### **4. Key Technical Challenges & Solutions**\n\n#### **Problem: Database Conflicts in Parallel Threads**\nIf two agents work on different features (threads), they cannot share the same local SQLite/Postgres database file without locking issues.\n*   **Solution:** **Ephemeral Databases**.\n    *   When the Worktree Manager spawns a thread, it also spins up a unique Docker container for DB *or* copies the `dev.sqlite` to `dev-feature-1.sqlite`.\n    *   It injects a custom `.env` file into that specific worktree folder pointing to the isolated DB.\n\n#### **Problem: Context Window Limits**\nYou cannot feed an entire 2-hour YouTube transcript and a GitHub repo into the prompt.\n*   **Solution:** **Semantic RAG**.\n    *   Do not dump the whole transcript.\n    *   When the agent is writing the \"Login\" component, the system queries the Vector DB for \"Login authentication patterns\" from the YouTube video and only injects those specific 20 lines of transcript into the prompt.\n\n### **5. Directory Structure Design**\n\nThe application should manage the project folder structure as follows:\n\n```text\n/My-New-Project\n├── .git/                 # The single shared git history\n├── main/                 # The \"Production\" code (standard checkout)\n├── .threads/             # HIDDEN directory managed by your app\n│   ├── feature-login/    # Worktree 1 (Filesystem isolated)\n│   │   ├── src/\n│   │   └── .env          # Points to DB_PORT=5433\n│   └── feature-admin/    # Worktree 2 (Filesystem isolated)\n│       ├── src/\n│       └── .env          # Points to DB_PORT=5434\n├── .context/             # Local storage for RAG\n│   ├── embeddings.lance/ # Vector DB files\n│   └── raw_data/         # Transcripts/PDFs\n└── project.json          # Metadata for your UI (Project status, threads)\n```"
      },
      {
        "id": "step-1",
        "name": "Architect",
        "agentType": "ARCHITECT",
        "description": "Executing Architect protocol...",
        "status": "completed",
        "output": {
          "architecture": "### ⚠️ Synthesis Error\n\nThe Council failed to merge sub-agent outputs. Please retry with a clearer scope.",
          "mermaidGraph": "graph TD; Error-->Retry;",
          "techStack": [],
          "libraries": []
        }
      },
      {
        "id": "step-2",
        "name": "Coder",
        "agentType": "CODER",
        "description": "Executing Coder protocol...",
        "status": "running"
      },
      {
        "id": "step-3",
        "name": "Council",
        "agentType": "COUNCIL",
        "description": "Executing Council protocol...",
        "status": "pending"
      }
    ],
    "currentStepIndex": 2,
    "status": "planning"
  },
  "mermaidGraph": "graph TD; Error-->Retry;"
}